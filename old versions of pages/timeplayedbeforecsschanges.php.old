<?php
include 'header.php';




$summoner = $_POST["summoner"];
if (isset($summoner) && $summoner != "Summoner name...") {
  $summoner = strtolower($summoner);
  $summoner = str_replace(' ','', $summoner);
  $region   = $_POST["region"];
  if (isset($_POST['eph']) &&
    $_POST['eph'] == 'yes') {
    header( 'Location: http://www.loltimeplayed.com/loading.php?region='.$region.'&summoner='.$summoner.'&eph=yes' );
  }
  else {
    header( 'Location: http://www.loltimeplayed.com/loading.php?region='.$region.'&summoner='.$summoner.'' );
  }

}


?>





<?php





$summoner         = $_GET["summoner"];
$region           = $_GET["region"];
$eph              = $_GET["eph"];


$originalsummoner = $summoner;
//$summoner = utf8_encode($summoner);


$jsonsmall        = file_get_contents('https://'.$region.'.api.pvp.net/api/lol/'.$region.'/v1.4/summoner/by-name/'.$summoner.'?api_key=a7ce7ac9-5d2f-4ee3-8548-adfc3a81c8b0');
$arraysmall       = json_decode($jsonsmall,true);

$json           = file_get_contents('https://'.$region.'.api.pvp.net/api/lol/'.$region.'/v1.3/stats/by-summoner/'.$arraysmall[$summoner]['id'].'/summary?season=SEASON4&api_key=a7ce7ac9-5d2f-4ee3-8548-adfc3a81c8b0');
$s4complexarray = json_decode($json,true);

$json           = file_get_contents('https://'.$region.'.api.pvp.net/api/lol/'.$region.'/v1.3/stats/by-summoner/'.$arraysmall[$summoner]['id'].'/summary?season=SEASON3&api_key=a7ce7ac9-5d2f-4ee3-8548-adfc3a81c8b0');
$s3complexarray = json_decode($json,true);

$json           = file_get_contents('https://'.$region.'.api.pvp.net/api/lol/'.$region.'/v1.3/stats/by-summoner/'.$arraysmall[$summoner]['id'].'/summary?season=SEASON2015&api_key=a7ce7ac9-5d2f-4ee3-8548-adfc3a81c8b0');
$s5complexarray = json_decode($json,true);

$size3       = count($s3complexarray );
$size4       = count($s4complexarray );
$size5       = count($s5complexarray );
$simplearray = array();
$id = $arraysmall[$summoner]['id'];
$y  = 0;

if ($arraysmall[$summoner]['id'] > 0) {

  if ($size3 > 0) {

    foreach ($s3complexarray['playerStatSummaries'] as $q) {

      $ai     = 0;
      $ranked = 0;
      if ($q['playerStatSummaryType'] == 'OneForAll5x5') {
        $q['playerStatSummaryType'] = 'OneForAllMirror';
        $gametime = 25;
      }

      if ($q['playerStatSummaryType'] == 'CAP5x5') {
        $q['playerStatSummaryType'] = 'TeamBuilder';
        $gametime = 35;
      }

      if ($q['playerStatSummaryType'] == 'CoopVsAI') {
        $q['playerStatSummaryType'] = 'Co-op vs AI 5v5';
        $gametime = 25;
        $ai       = 1;
      }

      if ($q['playerStatSummaryType'] == 'RankedPremade3x3') {
        $q['playerStatSummaryType'] = 'S3 Ranked 3v3';
        $gametime = 30;
        $ranked   = 1;
      }

      if ($q['playerStatSummaryType'] == 'RankedSolo5x5') {
        $q['playerStatSummaryType'] = 'S3 Ranked 5v5 Solo';
        $gametime = 35;
        $ranked   = 1;
      }

      if ($q['playerStatSummaryType'] == 'RankedTeam3x3') {
        $q['playerStatSummaryType'] = 'S3 Ranked 3v3';
        $gametime = 30;
        $ranked   = 1;
      }

      if ($q['playerStatSummaryType'] == 'RankedTeam5x5') {
        $q['playerStatSummaryType'] = 'S3 Ranked 5v5 Team';
        $gametime = 35;
        $ranked   = 1;
      }

      if ($q['playerStatSummaryType'] == 'Unranked') {
        $q['playerStatSummaryType'] = 'Normal 5v5';
        $gametime = 35;
      }

      if ($q['playerStatSummaryType'] == 'Unranked3x3') {
        $q['playerStatSummaryType'] = 'Normal 3v3';
        $gametime = 30;
      }

      if ($q['playerStatSummaryType'] == 'OdinUnranked') {
        $q['playerStatSummaryType'] = 'Dominion';
        $gametime = 20;
      }

      if ($q['playerStatSummaryType'] == 'AramUnranked5x5') {
        $q['playerStatSummaryType'] = 'ARAM';
        $gametime = 25;
      }

      if ($q['playerStatSummaryType'] == 'URF') {
        $q['playerStatSummaryType'] = 'URF';
        $gametime = 30;
      }

      if ($q['playerStatSummaryType'] == 'CoopVsAI3x3') {
        $q['playerStatSummaryType'] = 'Co-op vs AI 3v3';
        $gametime = 20;
        $ai       = 1;
      }

      if ($q['playerStatSummaryType'] == 'SummonersRift6x6') {
        $q['playerStatSummaryType'] = 'Hexakill SR';
        $gametime = 35;
      }

      if ($q['playerStatSummaryType'] == 'Hexakill') {
        $q['playerStatSummaryType'] = 'Hexakill TT';
        $gametime = 30;
      }


      if ($q['playerStatSummaryType'] == 'URFBots') {
        $q['playerStatSummaryType'] = 'URF Co-op vs AI';
        $gametime = 25;
        $ai       = 1;
      }

      if ($q['playerStatSummaryType'] == 'NightmareBot') {
        $q['playerStatSummaryType'] = 'NightmareBot';
        $gametime = 35;
        $ai       = 1;
      }



      $simplearray[$y]['GameType'] = $q['playerStatSummaryType'];

      if ($ranked == 0) {
        $q['losses'] = $q['wins'];
      }
      if ($ai == 1) {
        $q['losses'] = round($q['wins'] / 5) ;
      }

      $totalgames = $q['losses'] + $q['wins'];
      $simplearray[$y]['GamesPlayed'] = $totalgames;
      $simplearray[$y]['MinsPerGame'] = $gametime;
      $gamestime      = $totalgames * $gametime;
      $gamestimehours = $gamestime / 60;
      $simplearray[$y]['TotalTime'] = $gamestimehours;

      $y++;
    }

  }

  if ($size4 > 0) {

    foreach ($s4complexarray['playerStatSummaries'] as $q) {

      $position = 1000;
      $ai       = 0;
      $ranked   = 0;
      $y2       = $y;
      if ($q['playerStatSummaryType'] == 'OneForAll5x5') {
        $q['playerStatSummaryType'] = 'OneForAllMirror';
        $gametime = 25;
      }

      if ($q['playerStatSummaryType'] == 'CAP5x5') {
        $q['playerStatSummaryType'] = 'TeamBuilder';
        $gametime = 35;
      }

      if ($q['playerStatSummaryType'] == 'CoopVsAI') {
        $q['playerStatSummaryType'] = 'Co-op vs AI 5v5';
        $gametime = 25;
        $ai       = 1;
      }

      if ($q['playerStatSummaryType'] == 'RankedPremade3x3') {
        $q['playerStatSummaryType'] = 'S4 Ranked 3v3';
        $gametime = 30;
        $ranked   = 1;
      }

      if ($q['playerStatSummaryType'] == 'RankedSolo5x5') {
        $q['playerStatSummaryType'] = 'S4 Ranked 5v5 Solo';
        $gametime = 35;
        $ranked   = 1;
      }

      if ($q['playerStatSummaryType'] == 'RankedTeam3x3') {
        $q['playerStatSummaryType'] = 'S4 Ranked 3v3';
        $gametime = 30;
        $ranked   = 1;
      }

      if ($q['playerStatSummaryType'] == 'RankedTeam5x5') {
        $q['playerStatSummaryType'] = 'S4 Ranked 5v5 Team';
        $gametime = 35;
        $ranked   = 1;
      }

      if ($q['playerStatSummaryType'] == 'Unranked') {
        $q['playerStatSummaryType'] = 'Normal 5v5';
        $gametime = 35;
      }

      if ($q['playerStatSummaryType'] == 'Unranked3x3') {
        $q['playerStatSummaryType'] = 'Normal 3v3';
        $gametime = 30;
      }

      if ($q['playerStatSummaryType'] == 'OdinUnranked') {
        $q['playerStatSummaryType'] = 'Dominion';
        $gametime = 20;
      }

      if ($q['playerStatSummaryType'] == 'AramUnranked5x5') {
        $q['playerStatSummaryType'] = 'ARAM';
        $gametime = 25;
      }

      if ($q['playerStatSummaryType'] == 'URF') {
        $q['playerStatSummaryType'] = 'S4 URF';
        $gametime = 30;
      }

      if ($q['playerStatSummaryType'] == 'CoopVsAI3x3') {
        $q['playerStatSummaryType'] = 'Co-op vs AI 3v3';
        $gametime = 20;
        $ai       = 1;
      }

      if ($q['playerStatSummaryType'] == 'SummonersRift6x6') {
        $q['playerStatSummaryType'] = 'Hexakill SR';
        $gametime = 35;
      }

      if ($q['playerStatSummaryType'] == 'Hexakill') {
        $q['playerStatSummaryType'] = 'Hexakill TT';
        $gametime = 30;
      }


      if ($q['playerStatSummaryType'] == 'URFBots') {
        $q['playerStatSummaryType'] = 'URF Co-op vs AI';
        $gametime = 25;
        $ai       = 1;
      }

      if ($q['playerStatSummaryType'] == 'NightmareBot') {
        $q['playerStatSummaryType'] = 'NightmareBot';
        $gametime = 35;
        $ai       = 1;
      }

      for ($i = 0; $i < $y;$i++) {
        if ($simplearray[$i]['GameType'] == $q['playerStatSummaryType']) {
          $position = $i;
        }
      }

      if ($position < 1000) {
        $y = $position;
      }

      $simplearray[$y]['GameType'] = $q['playerStatSummaryType'];

      if ($ranked == 0) {
        $q['losses'] = $q['wins'];
      }
      if ($ai == 1) {
        $q['losses'] = round($q['wins'] / 5) ;
      }

      $totalgames = $q['losses'] + $q['wins'];
      $simplearray[$y]['GamesPlayed'] = $totalgames;
      $simplearray[$y]['MinsPerGame'] = $gametime;
      $gamestime      = $totalgames * $gametime;
      $gamestimehours = $gamestime / 60;
      $simplearray[$y]['TotalTime'] = $gamestimehours;
      $y = $y2;
      $y++;
    }

  }

  if ($size5 > 0) {

    foreach ($s5complexarray['playerStatSummaries'] as $q) {

      $position = 1000;
      $ai       = 0;
      $ranked   = 0;
      $y2       = $y;
      if ($q['playerStatSummaryType'] == 'OneForAll5x5') {
        $q['playerStatSummaryType'] = 'OneForAllMirror';
        $gametime = 25;
      }

      if ($q['playerStatSummaryType'] == 'CAP5x5') {
        $q['playerStatSummaryType'] = 'TeamBuilder';
        $gametime = 35;
      }

      if ($q['playerStatSummaryType'] == 'CoopVsAI') {
        $q['playerStatSummaryType'] = 'Co-op vs AI 5v5';
        $gametime = 25;
        $ai       = 1;
      }

      if ($q['playerStatSummaryType'] == 'RankedPremade3x3') {
        $q['playerStatSummaryType'] = 'S5 Ranked 3v3';
        $gametime = 30;
        $ranked   = 1;
      }

      if ($q['playerStatSummaryType'] == 'RankedSolo5x5') {
        $q['playerStatSummaryType'] = 'S5 Ranked 5v5 Solo';
        $gametime = 35;
        $ranked   = 1;
      }

      if ($q['playerStatSummaryType'] == 'RankedTeam3x3') {
        $q['playerStatSummaryType'] = 'S5 Ranked 3v3';
        $gametime = 30;
        $ranked   = 1;
      }

      if ($q['playerStatSummaryType'] == 'RankedTeam5x5') {
        $q['playerStatSummaryType'] = 'S5 Ranked 5v5 Team';
        $gametime = 35;
        $ranked   = 1;
      }

      if ($q['playerStatSummaryType'] == 'Unranked') {
        $q['playerStatSummaryType'] = 'Normal 5v5';
        $gametime = 35;
      }

      if ($q['playerStatSummaryType'] == 'Unranked3x3') {
        $q['playerStatSummaryType'] = 'Normal 3v3';
        $gametime = 30;
      }

      if ($q['playerStatSummaryType'] == 'OdinUnranked') {
        $q['playerStatSummaryType'] = 'Dominion';
        $gametime = 20;
      }

      if ($q['playerStatSummaryType'] == 'AramUnranked5x5') {
        $q['playerStatSummaryType'] = 'ARAM';
        $gametime = 25;
      }

      if ($q['playerStatSummaryType'] == 'URF') {
        $q['playerStatSummaryType'] = 'S5 URF';
        $gametime = 30;
      }

      if ($q['playerStatSummaryType'] == 'CoopVsAI3x3') {
        $q['playerStatSummaryType'] = 'Co-op vs AI 3v3';
        $gametime = 20;
        $ai       = 1;
      }

      if ($q['playerStatSummaryType'] == 'SummonersRift6x6') {
        $q['playerStatSummaryType'] = 'Hexakill SR';
        $gametime = 35;
      }

      if ($q['playerStatSummaryType'] == 'Hexakill') {
        $q['playerStatSummaryType'] = 'Hexakill TT';
        $gametime = 30;
      }


      if ($q['playerStatSummaryType'] == 'URFBots') {
        $q['playerStatSummaryType'] = 'URF Co-op vs AI';
        $gametime = 25;
        $ai       = 1;
      }

      if ($q['playerStatSummaryType'] == 'NightmareBot') {
        $q['playerStatSummaryType'] = 'NightmareBot';
        $gametime = 35;
        $ai       = 1;
      }

      for ($i = 0; $i < $y;$i++) {
        if ($simplearray[$i]['GameType'] == $q['playerStatSummaryType']) {
          $position = $i;
        }
      }

      if ($position < 1000) {
        $y = $position;
      }

      $simplearray[$y]['GameType'] = $q['playerStatSummaryType'];

      if ($ranked == 0) {
        $q['losses'] = $q['wins'];
      }
      if ($ai == 1) {
        $q['losses'] = round($q['wins'] / 5) ;
      }

      $totalgames = $q['losses'] + $q['wins'];
      $simplearray[$y]['GamesPlayed'] = $totalgames;
      $simplearray[$y]['MinsPerGame'] = $gametime;
      $gamestime      = $totalgames * $gametime;
      $gamestimehours = $gamestime / 60;
      $simplearray[$y]['TotalTime'] = $gamestimehours;
      $y = $y2;
      $y++;
    }

  }

  $sessionsPlayedS1 = 0;
  $sessionsPlayedS2 = 0;

  foreach ($simplearray as $key => $row) {
    $mid[$key] = $row['TotalTime'];
  }

  array_multisort($mid, SORT_DESC, $simplearray);

  $json       = file_get_contents('https://'.$region.'.api.pvp.net/api/lol/'.$region.'/v2.5/league/by-summoner/'.$arraysmall[$summoner]['id'].'/entry?api_key=a7ce7ac9-5d2f-4ee3-8548-adfc3a81c8b0');
  $url        = 'https://'.$region.'.api.pvp.net/api/lol/'.$region.'/v2.5/league/by-summoner/'.$arraysmall[$summoner]['id'].'/entry?api_key=a7ce7ac9-5d2f-4ee3-8548-adfc3a81c8b0';
  $rankeddata = json_decode($json,true);
  $elo        = 0;

  $ch         = curl_init($url);
  curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
  $hello      = curl_exec($ch);
  $statuscode = curl_getinfo($ch, CURLINFO_HTTP_CODE);

  if ($statuscode == '200') {

    $betterrankeddata = $rankeddata[$arraysmall[$summoner]['id']];

    if ($arraysmall[$summoner]['id'] > 0) {

      foreach ($betterrankeddata as $entry) {
        if ($entry['queue'] == 'RANKED_SOLO_5x5') {
          $tier = $entry['tier'];
          $rank = $entry['entries'][0]['division'];
          $lp   = $entry['entries'][0]['leaguePoints'];
        }
      }

    }

  }


  if ($tier == 'BRONZE') {
    if ($rank == 'I') {
      $elo = 1115;
    }
    if ($rank == 'II') {
      $elo = 1045;
    }
    if ($rank == 'III') {
      $elo = 975;
    }
    if ($rank == 'IV') {
      $elo = 905;
    }
    if ($rank == 'V') {
      $elo = 835;
    }
  }
  if ($tier == 'SILVER') {
    if ($rank == 'I') {
      $elo = 1465;
    }
    if ($rank == 'II') {
      $elo = 1395;
    }
    if ($rank == 'III') {
      $elo = 1325;
    }
    if ($rank == 'IV') {
      $elo = 1255;
    }
    if ($rank == 'V') {
      $elo = 1185;
    }
  }
  if ($tier == 'GOLD') {
    if ($rank == 'I') {
      $elo = 1815;
    }
    if ($rank == 'II') {
      $elo = 1745;
    }
    if ($rank == 'III') {
      $elo = 1675;
    }
    if ($rank == 'IV') {
      $elo = 1605;
    }
    if ($rank == 'V') {
      $elo = 1535;
    }
  }
  if ($tier == 'PLATINUM') {
    if ($rank == 'I') {
      $elo = 2165;
    }
    if ($rank == 'II') {
      $elo = 2095;
    }
    if ($rank == 'III') {
      $elo = 2025;
    }
    if ($rank == 'IV') {
      $elo = 1955;
    }
    if ($rank == 'V') {
      $elo = 1885;
    }
  }
  if ($tier == 'DIAMOND') {
    if ($rank == 'I') {
      $elo = 2515;
    }
    if ($rank == 'II') {
      $elo = 2445;
    }
    if ($rank == 'III') {
      $elo = 2375;
    }
    if ($rank == 'IV') {
      $elo = 2305;
    }
    if ($rank == 'V') {
      $elo = 2235;
    }
  }
  if ($tier == 'CHALLENGER') {
    $elo = 2585 + ($lp / 2);
  }

  $elo = $elo - 35;
  $elo = round($elo);



}
?>


<table ALIGN ="CENTER" style="width: 600" class="auto-style5" cellpadding="0" cellspacing="0">
  <tr>
    <td class="auto-style56">
      <div id="form" class="form_width">
        <form action="" method="post">
          <br>
          <input class="input" style="" type="text" name="summoner" id="pseudo" value="Summoner name..." onfocus="if(this.value == 'Summoner name...') { this.value = ''; }" onblur="if(this.value == '') { this.value = 'Summoner name...'; }"/>
          <select name="region" class="select">
            <option value="euw">
              euw
            </option>
            <option value="na">
              na
            </option>
            <option value="eune">
              eune
            </option>
            <option value="br">
              br
            </option>
            <option value="lan">
              lan
            </option>
            <option value="las">
              las
            </option>
            <option value="oce">
              oce
            </option>
            <option value="ru">
              ru
            </option>
            <option value="tr">
              tr
            </option>
            <option value="kr">
              kr
            </option>
          </select><br><input type="checkbox" name="eph" value="yes">
          <span style="font-size: medium; color: #FFFFFF">
            <strong>
              Also calculate elo per hour
            </strong>
          </span><br>
          <input class="submit" type="submit" name="submit" value="Calculate time played"/>
        </form>
      </div>
    </td>
  </tr>
</table>

<?php




echo '<table ALIGN ="CENTER" style="width: 600" class="auto-style5" cellpadding="0" cellspacing="0">
<tr>';

echo '<td class="auto-style56"><strong><span class="auto-style58"><br></span>Time played for '.$originalsummoner.' ('.$region.')</strong></td>';



echo '</tr>
</table>';

$maxy      = $y;
$totaltime = 0;

if ($arraysmall[$summoner]['id'] > 0) {

  echo '<table ALIGN ="CENTER" style="width: 600" class="auto-style5" cellpadding="0" cellspacing="0"><tr>';

  echo
  '<td style="width: 326px" class="auto-style2">&nbsp;</td>
  <td style="width: 198px" class="auto-style6"><strong>GAMES</strong></td>
  <td style="width: 354px" class="auto-style6"><strong>ESTIMATED GAME TIME (MINS)&nbsp;</strong></td>
  <td style="width: 302px" class="auto-style6"><strong>TOTAL TIME (HRS)</strong></td>';

  echo '</tr>';

  for ($y = 0; $y < $maxy; $y++) {

    if ($simplearray[$y]['GamesPlayed'] != 0) {
      echo'<tr>
      <td style="width: 326px" class="auto-style4"><strong>'.$simplearray[$y]['GameType'].'</strong></td>
      <td style="width: 198px" class="auto-style4">'.$simplearray[$y]['GamesPlayed'].'</td>
      <td style="width: 354px" class="auto-style4">'.$simplearray[$y]['MinsPerGame'].'</td>
      <td style="width: 302px" class="auto-style4">'.number_format((float) $simplearray[$y]['TotalTime'],1,'.',',').'</td>
      </tr>';
      $totaltime = $totaltime + $simplearray[$y]['TotalTime'];
    }
  }

  if ($eph == 'yes') {
    if ($elo != 0 ) {
      $eloperhour = $totaltime / $elo;
    }
    echo '<tr>
    <td align="left" colspan="3" style="width: 878px" class="auto-style2"><strong>';

    if ($elo > 0) {
      echo 'You are in '.$tier.' '.$rank.' with estimated elo '.$elo.'. You have spent '.number_format((float) $eloperhour,1,'.',',').' hours earning each point of elo.';
    }
    else {
      echo 'You are not currently ranked. Unable to calculate elo per hour.';
    }

    echo '</strong></td><td style="width: 302px" class="auto-style2"><strong>';

    echo number_format((float) $totaltime,0,'.',',').' hours<br>'.number_format((float) $totaltime / 24,1,'.',',').' days';

    echo'</strong></td>
    </tr>';
  }

  else {
    echo '<tr>
    <td style="width: 326px" class="auto-style2">&nbsp;</td>
    <td style="width: 198px" class="auto-style2"><strong>&nbsp;</strong></td>
    <td style="width: 354px" class="auto-style2"><strong>&nbsp;</strong></td>
    <td style="width: 302px" class="auto-style2"><strong>';

    echo number_format((float) $totaltime,0,'.',',').' hours<br>'.number_format((float) $totaltime / 24,1,'.',',').' days';

    echo'</strong></td>
    </tr>' ;
  }

  echo '</table>';

  $y     = 0;


  mysql_connect("localhost", "wwwlolti_mcplums", "W965ds+-");
  mysql_select_db("wwwlolti_goons");
  mysql_query("REPLACE INTO Goons (summoner, region, tier, division, hours, summonerid) VALUES ('$summoner','$region', '$tier', '$rank', '$totaltime', '$id')");
  $no100 = mysql_query("SELECT Hours FROM Top100 ORDER BY Hours ASC LIMIT 1") or die(mysql_error());
  $no100 = mysql_fetch_row($no100);
  if ($no100[0] <= $totaltime) {
    mysql_query("REPLACE INTO Top100 (summoner, region, tier, division, hours, summonerid) VALUES ('$summoner','$region', '$tier', '$rank', '$totaltime', '$id')");
  }

  echo '<table ALIGN ="CENTER" style="width: 600px">
  <tr>';

  echo "<td>Losses are
  not recorded except for ranked games, therefore in other queues total games has
  been estimated at 2 * wins (1.2 * wins for AI games). Does not include Season 1 and 2 ranked games at all as this is not available from Riot's API (riot pls?).</td>";

  echo '</tr>
  </table>';
}
else {
  echo '<table ALIGN ="CENTER" style="width: 600" class="auto-style5" cellpadding="0" cellspacing="0">
  <tr><td class="auto-style56"><strong><br>Summoner '.$originalsummoner.' ('.$region.') not found</strong></td>

  </tr>
  </table>';
}


?>

<br>
<?php
include 'footer.php';
?>



</body>


